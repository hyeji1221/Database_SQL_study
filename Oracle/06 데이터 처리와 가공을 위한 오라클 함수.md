# 06 데이터 처리와 가공을 위한 오라클 함수

## 06-1 오라클 함수

### 오라클 함수의 종류

#### 내장함수

입력 방식에 따라 데이터 처리에 사용하는 행이 나뉜다.

**단일행 함수** : 데이터가 한 행씩 입력되고 한 행당 결과가 하나씩 나오는 함수

**다중행 함수** : 여러 행이 입력되어 하나의 행으로 결과가 반환되는 함수

#### 사용자 지정 함수

## 06-2 문자 데이터를 가공하는 문자 함수

### 대.소문자를 바꿔주는 함수

**UPPER(문자열)** : 괄호 안 문자열을 모두 대문자로 변환하여 반환

**LOWER(문자열)** : 괄호 안 문자열을 모두 소문자로 변환하여 반환

**INITCAP(문자열)** : 괄호 안 문자 데이터 중 첫 글자는 대문자로, 나머지 문자를 소문자로 변환 후 반환 

UPPER, LOWER, INITCAP 함수를 사용하려면 입력 데이터에 열 일므이나 데이터를 직접 지정해야 한다.

### 문자열 길이를 구하는 LENGTH 함수

SELECT절, WHERE 절에 사용가능하다

바이트 수를 반환하는 LENGTHB 함수도 존재한다.

### 문자열 일부를 추출하는 SUBSTR 함수

**SUBSTR(문자열 데이터, 시작위치, 추출길이)** 

**SUBSTR(문자열 데이터, 시작위치)** : 시작위치부터 끝까지

다른 함수의 결과 값을 SUBSTR 함수의 입력 값으로 사용할 수도 있다.

### 문자열 데이터 안에서 특정 문자 위치를 찾는 INSTR 함수

총 네 개의 입력 값을 지정할 수 있으며 최소 두 개의 입력값 즉 **원본 문자열 데이터**와 **원본 문자열 데이터에서 찾으려는 문자** 이렇게 두 가지는 반드시 지정해 주어야 한다.

```SQL
INSTR ([대상 문자열 데이터(필수)],
      [위치를 찾으려는 부분 문자(필수)],
      [위치를 찾기 시작할 대상 문자열 데이터 위치(선택, 기본값은 1)],
      [시작 위치에서 찾으려는 문자가 몇 번째인지 지정(선택, 기본값은 1)])
```

### 특정 문자를 다른 문자로 바꾸는 REPLACE 함수

```sql
REAPLACE ([문자열 데이터 또는 열 이름(필수)], [찾는 문자(필수)], [대체할 문자(선택)])
```

대체할 문자를 입력하지 않는다면 찾는 문자로 지정한 문자는 문자열 데이터에서 삭제된다.

### 데이터의 빈 공간을 특정 문자로 채우는 LPAD, RPAD 함수

LPAD : Left Padding (왼쪽 패딩)

RPAD : Right Padding (오른쪽 패딩)

```sql
LPAD([문자열 데이터 또는 열이름(필수)], [데이터의 자릿수(필수)], [빈 공간에 채울 문자(선택)])
-- RPAD도 동일
```

**패딩 처리는 데이터의 일부만 노출해야 하는 개인정보를 출력할 때 사용하기도 한다**

### 두 문자열 데이터를 합치는 CONCAT 함수

|| 연산자는 CONCAT 함수와 유사하게 열이나 문자열을 연결한다.

### 특정 문자를 지우는 TRIM, LTRIM, RTRIM 함수

원본 문자열 데이터를 제외한 나머지 데이터는 모두 생략 가능 -> 삭제할 문자가 생략될 경우에 기본적으로 공백을 제거

**LEADING** : 왼쪽 글자 지우기

**TRAILING** : 오른쪽 글자 지우기

**BOTH** : 양쪽의 글자를 모두 지우기

```sql
LTRIM([원본 문자열 데이터(필수)], [삭제할 문자 집합(선택)])
RTRIM([원본 문자열 데이터(필수)], [삭제할 문자 집합(선택)])
```

## 06-3 숫자 데이터를 연산하고 수치를 조정하는 숫자 함수

### 특정 위치에서 반올림하는 ROUND 함수

반올림 할 위치를 지정하지 않으면 소수점 첫째 자리에서 반올림한 결과가 반환

```sql
ROUND([숫자(필수)], [반올림 위치(선택)])
```

### 특정 위치에서 버리는 TRUNC 함수

반올림 할 위치를 지정하지 않으면 소수점 첫째자리에서 버림 처리된다.

### 지정한 숫자와 가까운 정수를 찾는 CEIL, FLOOR 함수

각각 숫자와 가까운 큰 정수, 작은 정수를 반환하는 함수이다.

### 숫자를 나눈 나머지 값을 구하는 MOD 함수

```sql
MOD([나눗셈 될 숫자(필수)], [나눌 숫자(필수)])
```

## 06-4 날짜 데이터를 다루는 날짜 함수

**SYSDATE** 함수 : 입력 데이터 없이 현재 날짜 및 시간 정보를 구해준다.

### 몇 개월 이후 날짜를 구하는 ADD_MONTHS 함수

```
ADD_MONTHS([날짜 데이터(필수)], [더할 개월 수(정수)(필수)])
```

### 두 날짜 간의 개월 수 차이를 구하는 MONTHS_BETWEEN 함수

```
MONTHS_BETWEEN([날짜 데이터1(필수)], 날짜 데이터2(필수))
```

### 돌아오는 요일, 달의 마지막 날짜를 구하는 NEXT_DAY, LAST_DAY 함수

```
NEXT_DAY([날짜 데이터(필수)], [요일 문자(필수)])
LAST_DAY([날짜 데이터(필수)])
```

### 날짜의 반올림, 버림을 하는 ROUND, TRUNC 함수

소수점 위치 정보를 입력하지 않고 반올림, 버림의 기준이 될 포맷 값을 정해준다

ROUND : 반올림

TRUNC : 버림

## 06-5 자료형을 변환하는 형 변환 함수

형 변환 함수 : 각 데이터에 지정된 자료형을 바꿔 주는 함수

오라클에서 자료형이 자동으로 변환되는 방식이 아닌 사용자가 직접 지정해 주는 방식을 **명시적 형 변환**이라고 한다 

- TO_CHAR : 숫자 또는 날짜 데이터 -> 문자데이터 (포맷 입력 필수)

- TO_NUMBER : 문자 데이터 -> 숫자 데이터
- TO_DATE -> 문자 데이터 -> 날짜 데이터

## 06-6 NULL 처리 함수

### NVL 함수

첫 번째 입력 데이터가 NULL이 아니면 그 데이터를 그대로 반환하고 NULL이라면 두 번째 입력 데이터에 저장한 값을 반환한다

### NVL2 함수

NVL 함수와 비슷하지만 데이터가 NULL이 나리 때 반환할 데이터를 추가로 지정해 줄 수 있다.

NVL 함수와 달리 NULL이 아닌 경우에 반환 데이터까지 지정할 수 있으므로 더 다양한 용도로 활용 가능하다.

## 06-7 상황에 따라 다른 데이터를 반환하는 DECODE 함수와 CASE문

NVL, NVL2 함수는 데이터가 NULL인 경우에 어떤 데이터를 반환할지 정하는 함수이다

특정 열 값이나 데이터 값에 따라 어떤 데이터를 반환할지 정할 때는 DECODE 함수 또는 CASE문을 사용한다

DECODE 함수와 CASE문은 모두 조건별로 동일한 자료형의 데이터를 반환해야 한다

### DECODE 함수

한 행에 데이터를 입력받아 한 행으로 결과가 나오는 **단일행 함수**이다

조건에 해당하는 값이 없을 때 반환 값을 지정하지 않으면 NULL이 반환된다

### CASE문

기준 데이터를 반드시 명시하고 그 값에 따라 반환 데이터를 지정하는 DECODE 함수와 달리 CASE문은 **각 조건에 사용하는 데이터가 서로 상관없어도 된다** 또한 **기준 데이터 값이 같은(=) 데이터 외에 다양한 조건을 사용할 수 있다**

DECODE 함수는 모두 CASE문으로 바꿀 수 있으나 CASE문은 DECODE 함수가 표현할 수 없는 방식도 지원하므로 그 역은 성립하지 않을 수 있다 -> CASE문의 범용성이 더 높다



















